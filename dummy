<?php
session_start();
include('mysql.php');

// Überprüfen, ob der Benutzer angemeldet ist.
if (!isset($_SESSION["username"])) {
    header("Location: index.html");
    exit();
}

// Prüfen, ob das Formular abgeschickt wurde
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    if (isset($_POST['ausleihe_taetigen'])) {
        // Hier kannst du die ausgewählten Exemplar-IDs verarbeiten
        if (isset($_POST['selected_books'])) {
            $selected_books = $_POST['selected_books'];
            // Jetzt kannst du die Exemplar-IDs in der Datenbank verarbeiten, z.B. auf "nicht verfügbar" setzen
            foreach ($selected_books as $exemplar_id) {
                // Füge hier deine Logik für die Datenbankaktualisierung ein
                // Beispiel: $update_sql = "UPDATE exemplar SET verfügbarkeit = 0 WHERE exemplar_id = $exemplar_id";
                // $conn->query($update_sql);
            }
        }
    }
}
?>

<!DOCTYPE html>
<html lang="en">

<head>
    <!-- ... (wie zuvor) ... -->
</head>

<body>
    <div class="uk-container uk-margin-large-left uk-margin-large-right">
        <h1>Ausleihbare Bücher</h1>

        <form method="post" action="">
            <div class="uk-grid uk-child-width-1-1">
                <div>
                    <h2>Verfügbare Bücher</h2>
                    <table class="uk-table uk-table-striped uk-table-hover">
                        <!-- ... (wie zuvor) ... -->
                        <tbody>
                            <?php
                            // ... (wie zuvor) ...

                            if ($result->num_rows > 0) {
                                while ($row = $result->fetch_assoc()) {
                                    echo '<tr>';
                                    echo '<td style="text-align: center">' . $row["buch_ID"] . '</td>';
                                    // ... (weitere Spalten)
                                    echo '<td style="text-align: center"><input class="uk-checkbox" type="checkbox" name="selected_books[]" value="' . $row["exemplar_ID"] . '"></td>';
                                    echo '</tr>';
                                }
                            } else {
                                echo '<tr><td colspan="7">Keine Daten gefunden.</td></tr>';
                            }
                            ?>
                        </tbody>
                    </table>
                </div>
                <div class="uk-flex uk-flex-right">
                    <button class="uk-button uk-button-primary" type="submit" name="ausleihe_taetigen">Ausleihe tätigen</button>
                </div>
            </div>
        </form>
    </div>
</body>

</html>
